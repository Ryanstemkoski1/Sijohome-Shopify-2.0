{%- comment -%}
  Sijohome Bundle Discount Logic
  
  This snippet calculates bundle discounts for specific products and
  returns the discounted price and display information.
  
  Usage:
  {% render 'bundle-discount', product: product %}
  
  Returns:
  - bundle_discount_active: true/false
  - original_price: original product price
  - discounted_price: price after discount
  - discount_amount: amount saved
  - discount_percentage: percentage saved
  - display_badge: true/false if discount badge should show
{%- endcomment -%}

{%- liquid
  assign bundle_discount_active = false
  assign original_price = product.price
  assign discounted_price = product.price
  assign discount_amount = 0
  assign discount_percentage = 0
  assign display_badge = false
  
  if settings.sijo_active_bundle_discount and product.template_suffix == 'bundle'
    case product.title
      when 'LuxeWeave Linen Bedding Bundle'
        if settings.sijo_active_linen_discount
          assign bundle_discount_active = true
          assign discounted_price = original_price | times: 0.9
        endif
      when 'AiryWeight Eucalyptus Bedding Bundle'
        if settings.sijo_active_eucalyptus_discount
          assign bundle_discount_active = true
          assign discounted_price = original_price | times: 0.9
        endif
      when 'TempTune Cotton Bedding Bundle'
        if settings.sijo_active_cotton_discount
          assign bundle_discount_active = true
          assign discounted_price = original_price | times: 0.9
        endif
    endcase
    
    if bundle_discount_active
      assign discount_amount = original_price | minus: discounted_price
      assign discount_percentage = discount_amount | times: 100 | divided_by: original_price
      assign display_drop = discount_amount | divided_by: 100 | floor
      assign threshold_check = settings.sijo_bundle_threshold | divided_by: 100
      
      if display_drop >= threshold_check
        assign display_badge = true
      endif
    endif
  endif
-%}

{%- comment -%}Output bundle discount information for use in templates{%- endcomment -%}
{%- if bundle_discount_active -%}
  <script type="application/json" data-bundle-discount>
    {
      "active": {{ bundle_discount_active | json }},
      "originalPrice": {{ original_price | json }},
      "discountedPrice": {{ discounted_price | json }},
      "discountAmount": {{ discount_amount | json }},
      "discountPercentage": {{ discount_percentage | json }},
      "displayBadge": {{ display_badge | json }}
    }
  </script>
{%- endif -%}
