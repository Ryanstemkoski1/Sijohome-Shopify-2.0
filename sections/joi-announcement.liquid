{%- if section.settings.show_announcement -%}
  <div class="joi-announcement" id="joi-announcement-bar">
    <div class="joi-announcement__container">
      <div class="joi-announcement__content">
        {%- if section.settings.joi_logo != blank -%}
          <div class="joi-announcement__logo">
            <a href="{{ section.settings.joi_url | default: '/collections/joi' }}" aria-label="JOI by SIJO">
              <img src="{{ section.settings.joi_logo | image_url: width: 120 }}" 
                   alt="JOI by SIJO" width="60" height="auto" loading="lazy">
            </a>
          </div>
        {%- endif -%}

        <div class="joi-announcement__text">
          {%- if section.settings.announcement_text != blank -%}
            <p class="joi-announcement__message">{{ section.settings.announcement_text }}</p>
          {%- endif -%}
          {%- if section.settings.announcement_link_text != blank and section.settings.announcement_link_url != blank -%}
            <a href="{{ section.settings.announcement_link_url }}" class="joi-announcement__link">
              {{ section.settings.announcement_link_text }}
            </a>
          {%- endif -%}
        </div>

        {%- if section.settings.show_close_button -%}
          <button type="button" class="joi-announcement__close" onclick="this.closest('.joi-announcement').style.display='none'">
            <span class="sr-only">Close announcement</span>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        {%- endif -%}
      </div>
    </div>
  </div>

  <style>
    .joi-announcement {
      background: {{ section.settings.background_color | default: '#f8f5f0' }};
      color: {{ section.settings.text_color | default: '#2d2d2d' }};
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 10;
    }

    .joi-announcement__container {
      max-width: var(--page-width);
      margin: 0 auto;
      padding: 0 2rem;
    }

    .joi-announcement__content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      padding: 0.75rem 0;
      min-height: 50px;
      position: relative;
    }

    .joi-announcement__logo img {
      height: 32px;
      width: auto;
    }

    .joi-announcement__text {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .joi-announcement__message {
      margin: 0;
      font-size: 0.875rem;
      font-weight: 500;
      text-align: center;
    }

    .joi-announcement__link {
      font-size: 0.875rem;
      font-weight: 600;
      color: {{ section.settings.link_color | default: '#ff6b6b' }};
      text-decoration: none;
      border-bottom: 1px solid currentColor;
      transition: opacity 0.2s;
    }

    .joi-announcement__link:hover {
      opacity: 0.8;
    }

    .joi-announcement__close {
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 0.25rem;
      transition: background-color 0.2s;
    }

    .joi-announcement__close:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    /* Mobile styles */
    @media (max-width: 768px) {
      .joi-announcement__container {
        padding: 0 1rem;
      }

      .joi-announcement__content {
        flex-direction: column;
        gap: 0.5rem;
        padding: 1rem 0;
        text-align: center;
      }

      .joi-announcement__text {
        flex-direction: column;
        gap: 0.5rem;
      }

      .joi-announcement__close {
        position: absolute;
        right: 1rem;
        top: 0.5rem;
        transform: none;
      }
    }

    /* Set CSS custom property for header offset */
    :root {
      --joi-announcement-height: {{ section.settings.show_announcement | default: true | times: 50 }}px;
    }

    @media (max-width: 768px) {
      :root {
        --joi-announcement-height: {{ section.settings.show_announcement | default: true | times: 70 }}px;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const announcementBar = document.getElementById('joi-announcement-bar');
      if (announcementBar) {
        const height = announcementBar.offsetHeight;
        document.documentElement.style.setProperty('--joi-announcement-height', height + 'px');
        
        // Update height on window resize
        window.addEventListener('resize', function() {
          const newHeight = announcementBar.offsetHeight;
          document.documentElement.style.setProperty('--joi-announcement-height', newHeight + 'px');
        });
      }
    });
  </script>
{%- endif -%}

{% schema %}
{
  "name": "JOI Announcement",
  "class": "shopify-section--joi-announcement",
  "tag": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_announcement",
      "label": "Show JOI Announcement",
      "default": true
    },
    {
      "type": "header",
      "content": "JOI Branding"
    },
    {
      "type": "image_picker",
      "id": "joi_logo",
      "label": "JOI Logo",
      "info": "120x40px recommended"
    },
    {
      "type": "url",
      "id": "joi_url",
      "label": "JOI Collection URL",
      "default": "/collections/joi"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Announcement Text",
      "default": "Introducing JOI - Premium bedding designed for growing kids"
    },
    {
      "type": "text",
      "id": "announcement_link_text",
      "label": "Link Text",
      "default": "Shop JOI Collection"
    },
    {
      "type": "url",
      "id": "announcement_link_url",
      "label": "Link URL",
      "default": "/collections/joi"
    },
    {
      "type": "checkbox",
      "id": "show_close_button",
      "label": "Show Close Button",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f8f5f0"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#2d2d2d"
    },
    {
      "type": "color",
      "id": "link_color",
      "label": "Link Color",
      "default": "#ff6b6b"
    }
  ],
  "presets": [
    {
      "name": "JOI Announcement"
    }
  ]
}
{% endschema %}
